<div class="row g-2 mb-4">
  <div class="col-auto">
    <div class="card stat-card border-start border-4 border-primary">
      <div class="card-body">
        <div class="card-title d-flex align-items-center mb-2">
          <i class="bi bi-clock-history text-primary me-2"></i>
          <span>This Week</span>
        </div>
        <div class="stat-value text-primary">{{ myHours().total | number:'1.0-2' }} h</div>
        <div class="card-subtitle text-muted">Total entered</div>
      </div>
    </div>
  </div>

  <div class="col-auto">
    <div class="card stat-card border-start border-4 border-warning">
      <div class="card-body">
        <div class="card-title d-flex align-items-center mb-2">
          <i class="bi bi-send text-warning me-2"></i>
          <span>Submitted</span>
        </div>
        <div class="stat-value text-warning">{{ myHours().submitted | number:'1.0-2' }} h</div>
        <div class="card-subtitle text-muted">Awaiting approval</div>
      </div>
    </div>
  </div>

  <div class="col-auto">
    <div class="card stat-card border-start border-4 border-success">
      <div class="card-body">
        <div class="card-title d-flex align-items-center mb-2">
          <i class="bi bi-check-circle text-success me-2"></i>
          <span>Approved/Locked</span>
        </div>
        <div class="stat-value text-success">{{ myHours().approved | number:'1.0-2' }} h</div>
        <div class="card-subtitle text-muted">Ready for billing</div>
      </div>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center gap-3">
      <h5 class="card-title mb-0">Project Utilization (Approved/Locked)</h5>
      
      <!-- Date Range Toggle -->
      <div class="btn-group btn-group-sm" role="group">
        <input type="radio" class="btn-check" name="dateRange" id="weekRange" 
               [checked]="dateRangeMode() === 'week'" 
               (change)="dateRangeMode() === 'month' && toggleDateRange()">
        <label class="btn btn-outline-secondary" for="weekRange">This Week</label>

        <input type="radio" class="btn-check" name="dateRange" id="monthRange" 
               [checked]="dateRangeMode() === 'month'" 
               (change)="dateRangeMode() === 'week' && toggleDateRange()">
        <label class="btn btn-outline-secondary" for="monthRange">This Month</label>
      </div>
    </div>
    
    <!-- Date Range Controls in header -->
    <div class="d-flex align-items-center gap-3">
      <div class="d-flex gap-3">
        <div class="date-field">
          <label class="form-label mb-1">From</label>
          <input type="date" class="form-control form-control-sm" [value]="from()" (input)="from.set($any($event.target).value); load()">
        </div>

        <div class="date-field">
          <label class="form-label mb-1">To</label>
          <input type="date" class="form-control form-control-sm" [value]="to()" (input)="to.set($any($event.target).value); load()">
        </div>
      </div>
      
      <button type="button" class="btn btn-outline-primary btn-sm" (click)="load()" title="Refresh">
        <i class="bi bi-arrow-clockwise"></i>
      </button>
    </div>
  </div>
  
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover table-bordered">
        <thead class="table-light">
          <tr>
            <th>Project</th>
            <th>Billable h</th>
            <th>Total h</th>
            <th>Util %</th>
          </tr>
        </thead>
        <tbody>
          @for (row of util(); track row.project_id) {
            <tr>
              <td>
                <div class="mono">{{ row.project_code }}</div>
                <div class="text-muted">{{ row.project_name }}</div>
              </td>
              <td>{{ row.billable_hours | number:'1.0-2' }}</td>
              <td>{{ row.total_hours | number:'1.0-2' }}</td>
              <td>
                <span class="badge" [class]="getUtilizationBadgeClass(row.utilization_pct)">
                  {{ row.utilization_pct | number:'1.0-2' }}%
                </span>
              </td>
            </tr>
          }
          @empty {
            <tr>
              <td colspan="4" class="text-center text-muted py-4">
                <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                No data available for selected date range
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
  
  <div class="card-footer d-flex gap-2 justify-content-end">
    <a class="btn btn-outline-primary" [routerLink]="['/timesheets']">
      <i class="bi bi-pencil-square me-1"></i>
      Open My Timesheet
    </a>
    <a class="btn btn-outline-secondary" [routerLink]="['/approvals']">
      <i class="bi bi-check2-square me-1"></i>
      Open Approvals
    </a>
  </div>
</div>

